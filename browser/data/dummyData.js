var dummyDict = {"entry_list":{"$":{"version":"1.0"},"entry":[{"$":{"id":"hello"},"ew":["hello"],"hw":["hel*lo"],"sound":[{"wav":["hello001.wav"],"wpr":["hu-!lO"]}],"pr":["hə-ˈlō, he-"],"fl":["noun"],"in":[{"il":["plural"],"if":["hellos"]}],"et":[{"_":"alteration of ","it":["hollo"]}],"def":[{"date":["1877"],"dt":[{"_":":an expression or gesture of greeting ","un":["used interjectionally in greeting, in answering the telephone, or to express surprise"]}]}]},{"$":{"id":"hullo"},"ew":["hullo"],"hw":["hul*lo"],"sound":[{"wav":["hullo001.wav"],"wpr":["(+)hu-!lO"]}],"pr":["(ˌ)hə-ˈlō"],"cx":[{"cl":["chiefly British variant of"],"ct":["hello"]}]}]}},
	dummyThes = {"entry_list":{"$":{"version":"1.0"},"entry":[{"$":{"id":"hello"},"term":[{"hw":["hello"]}],"fl":["noun"],"sens":[{"mc":["an expression of goodwill upon meeting"],"vi":[{"_":"we said our and got right down to business","it":["hellos"]}],"syn":["greeting, salutation, salute, welcome"],"rel":["ave, hail; amenities, civilities, pleasantries; regards, respects, wishes"],"ant":[{"_":"adieu, bon voyage, congé ( congee), farewell, Godspeed, good-bye ( good-by)","it":["also","or"]}]}]}]}},
	complexDummy = {"entry_list":{"$":{"version":"1.0"},"entry":[{"$":{"id":"hit[1]"},"ew":["hit"],"subj":["HF-vt6d#HF-vi2c#SF-vt6f#SB-vi2d#SB-vt6g#AV-vi5#SP-vt1c#GA-8"],"hw":[{"_":"hit","$":{"hindex":"1"}}],"sound":[{"wav":["hit00001.wav"],"wpr":["!hit"]}],"pr":["ˈhit"],"fl":["verb"],"in":[{"if":["hit"]},{"if":["hit*ting"]}],"et":[{"_":"Middle English, from Old English probably from Old Norse to meet with, hit","it":["hyttan,","hitta"]}],"def":[{"vt":["transitive verb","intransitive verb"],"date":["before 12th century"],"sn":["1 a","b","c","2 a","b","c","3","4","5","6 a","b","c","d","e","f","g","7","8","1 a","b","2 a","b","c","d","3","4","5"],"dt":[":to reach with or as if with a blow",{"_":":to come in contact with ","vi":[{"_":"the ball the window","it":["hit"]}]},":to strike (as a ball) with an object (as a bat, club, or racket) so as to impart or redirect motion",":to cause to come into contact",":to deliver (as a blow) by action",{"_":":to apply forcefully or suddenly ","vi":[{"_":" the brakes","it":["hit"]}]},{"_":":to affect especially detrimentally ","vi":[{"_":"farmers by drought","it":["hit"]}]},{"_":":to make a request of ","vi":[{"_":" his friend for 10 dollars","it":["hit"]}],"un":[{"_":"often used with ","it":["up"]}]},":to discover or meet especially by chance",{"_":":to accord with :","sx":["suit"]},{"_":": ","sx":["reach","attain"],"vi":[{"_":"prices a new high","it":["hit"]}]},{"_":":to arrive or appear at, in, or on ","vi":[{"_":" town","it":["hit"]},{"_":"the best time to the stores","it":["hit"]}]},":to bite at or on",{"_":":to reflect accurately ","vi":[{"_":" the right note","it":["hit"]}]},{"_":":to reach or strike (as a target) especially for a score in a game or contest ","vi":[{"_":"couldn't seem to the basket","it":["hit"]}]},{"_":":","sx":[{"_":"bat ","sxn":["2b"]}]},{"_":":to indulge in excessively ","vi":[{"_":" the bottle","it":["hit"]}]},":to deal another card to (as in blackjack)",":to strike a blow",{"_":":to arrive with a forceful effect like that of a blow ","vi":[{"_":"the storm ","it":["hit"]}]},":to come into contact with something",{"_":":","sx":["attack"]},{"_":":","sx":[{"_":"strike ","sxn":["11b"]}]},{"_":":","sx":[{"_":"bat ","sxn":["1"]}]},{"_":":to succeed in attaining or coming up with something ","un":[{"_":"often used with or ","it":["on","upon"],"vi":[{"_":" on a solution","it":["hit"]}]}]},{"_":":to be in agreement :","sx":["suit"]},":to fire the charge in the cylinders"],"ssl":["of fish","of a fish","obsolete","of an internal combustion engine"]}],"uro":[{"ure":["hit*ter"],"fl":["noun"]}],"dro":[{"drp":["hit it big"],"def":[{"dt":[":to achieve great success"]}]},{"drp":["hit it off"],"def":[{"dt":[{"_":":to get along well :become friends ","vi":[{"_":"they immediately","it":["hit it off"]}]}]}]},{"drp":["hit on"],"def":[{"dt":[":to make especially sexual overtures to"]}]},{"drp":["hit the books"],"def":[{"dt":[":to study especially with intensity"]}]},{"drp":["hit the fan"],"def":[{"dt":[":to have a major usually undesirable impact"]}]},{"drp":["hit the ground running"],"def":[{"dt":[":to begin or proceed quickly, energetically, or effectively"]}]},{"drp":["hit the hay"],"vr":[{"vl":["or"],"va":["hit the sack"]}],"def":[{"dt":[":to go to bed"]}]},{"drp":["hit the high points"],"vr":[{"vl":["or"],"va":["hit the high spots"]}],"def":[{"dt":[":to touch on or at the most important points or places"]}]},{"drp":["hit the jackpot"],"def":[{"dt":[":to become notably and unexpectedly successful"]}]},{"drp":["hit the nail on the head"],"def":[{"dt":[":to be exactly right"]}]},{"drp":["hit the road"],"def":[{"dt":[{"_":": ","sx":["leave","travel"]},":to set out"],"sd":["also"]}]},{"drp":["hit the roof"],"vr":[{"vl":["or"],"va":["hit the ceiling"]}],"def":[{"dt":[":to give vent to a burst of anger or angry protest"]}]},{"drp":["hit the spot"],"def":[{"dt":[{"_":":to give complete or special satisfaction ","un":["used especially of food or drink"]}]}]},{"drp":["hit the wall"],"def":[{"sn":["1","2"],"dt":[":to reach the point of physical exhaustion during strenuous activity",":to reach a limiting point or situation at which progress or success ceases"]}]}]},{"$":{"id":"hit[2]"},"ew":["hit"],"subj":["SB-4#SY-6#LW-6#DG-5#TL-7#CP-7#CP-8"],"hw":[{"_":"hit","$":{"hindex":"2"}}],"fl":["noun"],"def":[{"date":["15th century"],"sn":["1","2 a","b","3","4","5","6","7","8"],"dt":[{"_":":an act or instance of hitting or being hit ","vi":[{"_":"more than misses","it":["hit","s"]}]},":a stroke of luck",":a great success",":a telling or critical remark",{"_":":","sx":["base hit"]},":a quantity of a drug ingested at one time",":a premeditated murder committed especially by a member of a crime syndicate",{"_":":an instance of connecting to a particular Web site ","vi":[{"_":"a million per day","it":["hit","s"]}]},":a successful match in a search (as of a computer database or the Internet)"]}],"uro":[{"ure":["hit*less"],"sound":[{"wav":["hit00002.wav"],"wpr":["!hit-lus"]}],"pr":["ˈhit-ləs"],"fl":["adjective"]}]},{"$":{"id":"hit-and-miss"},"ew":["hit-and-miss"],"hw":["hit–and–miss"],"sound":[{"wav":["hitand01.wav"],"wpr":["+hi-t/un-!mis"]}],"pr":["ˌhit-ᵊn-ˈmis"],"fl":["adjective"],"def":[{"date":["1897"],"dt":[":sometimes successful and sometimes not :not reliably good or successful"]}]},{"$":{"id":"hit-and-run[1]"},"ew":["hit-and-run"],"subj":["SB-1#LW-2"],"hw":[{"_":"hit–and–run","$":{"hindex":"1"}}],"sound":[{"wav":["hitand02.wav"],"wpr":["+hi-t/un-!run"]}],"pr":["-ˈrən"],"fl":["adjective"],"def":[{"date":["1899"],"sn":["1","2","3"],"dt":[":being or relating to a hit-and-run in baseball",":being or involving a motor-vehicle driver who does not stop after being involved in an accident",{"_":":involving or intended for quick specific action or results ","vi":[{"_":"a raid","it":["hit–and–run"]}]}]}]},{"$":{"id":"hit-and-run[2]"},"ew":["hit-and-run"],"subj":["SB"],"hw":[{"_":"hit–and–run","$":{"hindex":"2"}}],"fl":["noun"],"def":[{"date":["1904"],"dt":[":a baseball play calling for a runner on first to begin running as a pitch is delivered and for the batter to attempt to hit the pitch"]}]},{"$":{"id":"hit-and-run[3]"},"ew":["hit-and-run"],"subj":["SB"],"hw":[{"_":"hit–and–run","$":{"hindex":"3"}}],"fl":["verb"],"def":[{"vt":["intransitive verb"],"date":["1966"],"dt":[":to execute a hit-and-run play in baseball"]}]},{"$":{"id":"hit list"},"ew":["hit list"],"hw":["hit list"],"fl":["noun"],"def":[{"date":["1972"],"dt":[":a list of persons or programs to be opposed or eliminated",":a list of those targeted for special attention or treatment"],"sd":["broadly"]}]},{"$":{"id":"hit man"},"ew":["hit man"],"subj":["SY#PU-2"],"hw":["hit man"],"fl":["noun"],"def":[{"date":["1963"],"sn":["1","2"],"dt":[":a professional assassin who works for a crime syndicate",{"_":":","sx":["hatchet man"]}]}]},{"$":{"id":"hit or miss"},"ew":["hit or miss"],"grp":["hit or","hit miss","or miss"],"hw":["hit or miss"],"fl":["adverb"],"def":[{"date":["1606"],"dt":[{"_":":in a hit-or-miss manner :","sx":["haphazardly"]}]}]},{"$":{"id":"hit-or-miss"},"ew":["hit-or-miss"],"hw":["hit–or–miss"],"sound":[{"wav":["hitorm01.wav"],"wpr":["+hit-ur-!mis"]}],"pr":["ˌhit-ər-ˈmis"],"fl":["adjective"],"def":[{"date":["1848"],"dt":[":marked by a lack of care, forethought, system, or plan",{"_":":","sx":["hit-and-miss"]}],"sd":["also"]}]}]}},
	wordRef = ["1 a","b","c","2 a","b","c","3","4","5","6 a","b","c","d","e","f","g","7","8","1 a","b","2 a","b","c","d","3","4","5"];

//////// new and improved functions

function wordObjectParser (word, data) {
	var searchData = data.entry_list.entry,
		wordId,
		wordObjects = [];
		
	searchData.forEach(function(entry) {
		wordId = entry.ew[0];
		if (wordId === word) {
			var definitionData = definitionGetter(entry);
			wordObjects.push(definitionData);
		}
	})
	return wordObjects;
}

function definitionGetter (defData) {
	var definitionArr = defData.def[0].dt,
		definitionObj = {},
		definitions = [];
	definitionArr.forEach(function (definition, index, array){
		//traverse definition arrays and return all necessary definition strings
		if (typeof definition  === 'string') {
			definition = colonSplice(definition);
			definition = definition.trim();
			definitions.push(definition);
		}
		else if (typeof definition === 'object') {
			var underscoreDefArr = underscoreWordParse(definition);
			definitions = definitions.concat(underscoreDefArr);
		}
	});
	//get necessary data like parts of speech, dates, pronunciation etc. 
	
	definitionObj.definitions = definitions;
	return definitionObj;
}

function underscoreWordParse (underscoreStr) {
	var underscoreDefs = [];
	if (underscoreStr._.length > 2) {
		var defUnderscore = underscoreStr._;
		defUnderscore = colonSplice(defUnderscore)
		defUnderscore = defUnderscore.trim();
		underscoreDefs.push(defUnderscore);
	}
	else if (underscoreStr._.length <= 2) {
		var sxArray = underscoreStr.sx;
		if (typeof sxArray[0] === 'object') {
			var trimmedSubDef = sxArray[0]._.trim();
			underscoreDefs.push(trimmedSubDef);
		}
		else if (typeof sxArray[0] === 'string' && sxArray.length === 1) {
			var cleanStr = colonSplice(sxArray[0]);
			underscoreDefs.push(cleanStr);
		} 
		else {
			underscoreDefs.push(sxArray.join(', '));
		}
	}
	return underscoreDefs;
};

function colonSplice (str) {
	while (str.indexOf(':') !== -1) {
		var colonToSlice = str.indexOf(':');
		str = stringSplice(str, colonToSlice, 1)
	}
	return str;
};

function stringSplice(str, index, count, add) {
  return str.slice(0, index) + (add || "") + str.slice(index + count);
};

// function definitionArrayParser (definition, index, array){
// 	if (typeof definition  === 'string') {
// 		definition = colonSplice(definition);
// 		definition = definition.trim();
// 		return definition;
// 	}
// 	else if (typeof definition === 'object') {
// 		var toConcat = underscoreWordParse(definition);
// 		return toConcat;
// 	}
// };

console.log('testing new functions: ', wordObjectParser('hit', complexDummy));


//////// end of new and improved functions

function getDefinitions (word, data) {
	var toManipulate = data.entry_list.entry,
		wordObject = {},
		definitions = [],
		guides = [];
	toManipulate.forEach(function(entry) {
		if (entry.ew[0] === word) {
			var newDef = definitionArrayParser(entry);
			var outline = WordOutline(entry.def[0].sn);
			guides.push(outline);
			definitions.push(newDef);
		}
	})
	wordObject.definitions = definitions;
	wordObject.guides = guides;
	return wordObject;
};

function definitionArrayParser (defObject){
	var mappedDefs = [];
	defObject.def[0].dt.forEach(function(definition){
		if (typeof definition  === 'string') {
			if (definition[0] === ':') definition = definition.slice(1);
			mappedDefs.push(definition);
		}
		else if (definition._.length > 2) {
			var defStr = definition._;
			//some of merrriam webster subdefinitions are stored as values to the '_' key
			//furthermore, some of these subdefinition strings end with a colon (": ") in order to display examples
			//this if statement checks and deletes the colon before trimming the string
			if (defStr[defStr.length-1] === ':') {
				defStr = defStr.slice(0, -1);
			}
			if (defStr[0] === ':') defStr = defStr.slice(1);
			defStr = defStr.trim();
			mappedDefs.push(defStr);
		}
		else if (definition._.length <= 2) {
			if (typeof definition.sx[0] === 'string') {
				if (definition.sx.length === 1) mappedDefs.push(definition.sx[0]);
				else  mappedDefs.push(definition.sx.join(', '));
			}
			else if (typeof definition.sx[0] === 'object') {
				var trimmedSubDef = definition.sx[0]._.trim();
				mappedDefs.push(trimmedSubDef);
			}
		}
	})
	return mappedDefs;
}

function WordOutline (guide) {
	var outline = {};
	var nums = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];

	for (var i = 0; i < guide.length; i++) {
		// check if definition has multiple subdefinitions
		if (guide[i].length > 1) {
			//create new array within the outline to hold subdefitions a, b, c....
			var subDef = guide[i].split(' ');
			var keyReference;

			if (!outline[subDef[0]]) {
				keyRef = subDef[0];
				
			}
			else {
				keyRef = subDef[0] + '.1';
			}
			
			outline[keyRef] = [];
			outline[keyRef].push(subDef[1]);

			//loop to push all subefinitions to this array
			var go = true;
			for (var j = i + 1; j < guide.length; j++) {
				if (go) {
					if (guide[j].length === 1 && nums.indexOf(guide[j]) < 0) {
						outline[keyRef].push(guide[j]);
					}

					else if (guide[j].length !== 1 || nums.indexOf(guide[j]) > -1) {
						go = false;
						i = j-1;
					}
				}
			}
		}
		else if (guide[i].length === 1) {
			var keyReference;

			if (!outline[guide[i]]) {
				keyRef = guide[i];
				
			}
			else {
			// temporarily disabled... if the for loop encounters a new definition altogether, simply return
			//Once basic rendering is figured out, the outline and fullRender functions will be reworked to accomodate distinct definitions
				keyRef = guide[i] + '.1';
				// outline[keyRef] = WordOutline(guide.slice(i));
				// return outline;
			}

			outline[keyRef] = keyRef;
		}
	}
	return outline;
}

function WordOutlineDef (guide, defs) {
	var outline = {};
	var nums = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
	for (var i = 0; i < guide.length; i++) {
		// check if definition has multiple subdefinitions
		if (guide[i].length > 1) {
			//create new array within the outline to hold subdefitions a, b, c....
			var subDef = guide[i].split(' ');
			var keyRef;

			if (!outline[subDef[0]]) {
				keyRef = subDef[0];
				
			}
			else {
				keyRef = subDef[0] + '.1';
			}
			
			outline[keyRef] = [];
			outline[keyRef].push(defs.splice(0, 1)[0]);

			//loop to push all subefinitions to this array
			var go = true;
			for (var j = i + 1; j < guide.length; j++) {
				if (go) {
					if (guide[j].length === 1 && nums.indexOf(guide[j]) < 0) {
						outline[keyRef].push(defs.splice(0, 1)[0]);
					}

					else if (guide[j].length !== 1 || nums.indexOf(guide[j]) > -1) {
						go = false;
						i = j-1;
					}
				}
			}
		}
		else if (guide[i].length === 1) {
			var keyRef;

			if (!outline[guide[i]]) {
				keyRef = guide[i];
				
			}
			else {
			// temporarily disabled... if the for loop encounters a new definition altogether, simply return
			//Once basic rendering is figured out, the outline and fullRender functions will be reworked to accomodate distinct definitions
				keyRef = guide[i] + '.1';
				// outline[keyRef] = WordOutline(guide.slice(i));
				// return outline;
			}
			outline[keyRef] = defs.splice(0,1)[0];
		}
	}
	return outline;
}

function getDefinitionsOne (word, data) {
	var toManipulate = data.entry_list.entry,
		wordArr = [];
	toManipulate.forEach(function(entry) {
		if (entry.ew[0] === word) {
			var newDef = definitionArrayParser(entry);
			var result = WordOutlineDef(entry.def[0].sn, newDef);
			wordArr.push(result);			
		}
	})
	return wordArr;
}

var toTest = complexDummy.entry_list.entry;
// console.log('testing definition func', getDefinitions('hit', complexDummy));
console.log('old functions: ', getDefinitionsOne('hit', complexDummy));